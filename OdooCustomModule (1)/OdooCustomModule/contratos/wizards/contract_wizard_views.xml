
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista del wizard paso a paso -->
    <record id="view_contract_wizard_form" model="ir.ui.view">
        <field name="name">contract.wizard.form</field>
        <field name="model">contract.wizard</field>
        <field name="arch" type="xml">
            <form string="Asistente para Creación de Contratos">
                <header>
                    <!-- Botones de navegación -->
                    <button name="action_previous_step" type="object" 
                            string="◀ Anterior" 
                            attrs="{'invisible': [('step', '=', 'step1')]}" 
                            class="btn-secondary"/>
                    
                    <button name="action_next_step" type="object" 
                            string="Siguiente ▶" 
                            attrs="{'invisible': [('step', '=', 'step5')]}" 
                            class="btn-primary"/>
                    
                    <button name="action_create_contract" type="object" 
                            string="✓ Crear Contrato" 
                            attrs="{'invisible': [('step', '!=', 'step5')]}" 
                            class="btn-success"/>
                    
                    <!-- Indicador de progreso -->
                    <div class="progress-indicator">
                        <div class="step-indicator">
                            <span class="step-number" 
                                  attrs="{'class': 'step-number active' if step in ['step1', 'step2', 'step3', 'step4', 'step5'] else 'step-number'}">1</span>
                            <span class="step-label">Cliente</span>
                        </div>
                        <div class="step-indicator">
                            <span class="step-number" 
                                  attrs="{'class': 'step-number active' if step in ['step2', 'step3', 'step4', 'step5'] else 'step-number'}">2</span>
                            <span class="step-label">Tipo</span>
                        </div>
                        <div class="step-indicator">
                            <span class="step-number" 
                                  attrs="{'class': 'step-number active' if step in ['step3', 'step4', 'step5'] else 'step-number'}">3</span>
                            <span class="step-label">Legal</span>
                        </div>
                        <div class="step-indicator">
                            <span class="step-number" 
                                  attrs="{'class': 'step-number active' if step in ['step4', 'step5'] else 'step-number'}">4</span>
                            <span class="step-label">Financiero</span>
                        </div>
                        <div class="step-indicator">
                            <span class="step-number" 
                                  attrs="{'class': 'step-number active' if step == 'step5' else 'step-number'}">5</span>
                            <span class="step-label">Revisión</span>
                        </div>
                    </div>
                </header>

                <sheet>
                    <!-- Paso 1: Información del Cliente -->
                    <div attrs="{'invisible': [('step', '!=', 'step1')]}">
                        <div class="oe_title">
                            <h1>Paso 1: Información del Cliente</h1>
                            <p>Seleccione la empresa cliente o cree una nueva</p>
                        </div>
                        
                        <group>
                            <field name="create_new_partner"/>
                        </group>
                        
                        <group attrs="{'invisible': [('create_new_partner', '=', True)]}">
                            <field name="partner_id" options="{'no_create': True, 'no_create_edit': True}"
                                   attrs="{'required': [('create_new_partner', '=', False)]}"/>
                        </group>
                        
                        <group string="Nueva Empresa" attrs="{'invisible': [('create_new_partner', '=', False)]}">
                            <field name="partner_name" attrs="{'required': [('create_new_partner', '=', True)]}"/>
                            <field name="partner_email"/>
                            <field name="partner_phone"/>
                            <field name="partner_vat" string="Cédula Jurídica"/>
                        </group>
                    </div>

                    <!-- Paso 2: Tipo y Configuración -->
                    <div attrs="{'invisible': [('step', '!=', 'step2')]}">
                        <div class="oe_title">
                            <h1>Paso 2: Tipo y Configuración del Contrato</h1>
                            <p>Configure los detalles básicos del contrato</p>
                        </div>
                        
                        <group>
                            <group>
                                <field name="contract_type_id" attrs="{'required': [('step', '=', 'step2')]}"/>
                                <field name="template_id"/>
                                <field name="date_start"/>
                                <field name="duration_months"/>
                                <field name="auto_renewal"/>
                            </group>
                            <group>
                                <field name="contract_manager_id"/>
                            </group>
                        </group>
                        
                        <group string="Descripción de Servicios">
                            <field name="service_description" nolabel="1" 
                                   attrs="{'required': [('step', '=', 'step2')]}"/>
                        </group>
                    </div>

                    <!-- Paso 3: Representante Legal -->
                    <div attrs="{'invisible': [('step', '!=', 'step3')]}">
                        <div class="oe_title">
                            <h1>Paso 3: Representante Legal</h1>
                            <p>Configure la información del representante legal que firmará el contrato</p>
                        </div>
                        
                        <group>
                            <field name="create_new_legal_contact"/>
                        </group>
                        
                        <group attrs="{'invisible': [('create_new_legal_contact', '=', True)]}">
                            <field name="legal_contact_id" 
                                   domain="[('is_company', '=', False)]"
                                   attrs="{'required': [('create_new_legal_contact', '=', False)]}"/>
                        </group>
                        
                        <group string="Datos del Representante Legal" 
                               attrs="{'invisible': [('create_new_legal_contact', '=', False)]}">
                            <group>
                                <field name="legal_representative_name" 
                                       attrs="{'required': [('create_new_legal_contact', '=', True)]}"/>
                                <field name="legal_representative_position" 
                                       attrs="{'required': [('create_new_legal_contact', '=', True)]}"/>
                                <field name="legal_representative_hierarchy"/>
                                <field name="legal_representative_id_number" 
                                       attrs="{'required': [('create_new_legal_contact', '=', True)]}"/>
                            </group>
                            <group>
                                <field name="legal_representative_email" 
                                       attrs="{'required': [('create_new_legal_contact', '=', True)]}"/>
                                <field name="legal_representative_phone"/>
                            </group>
                        </group>
                        
                        <group string="Dirección" attrs="{'invisible': [('create_new_legal_contact', '=', False)]}">
                            <field name="legal_representative_address" nolabel="1"/>
                        </group>
                    </div>

                    <!-- Paso 4: Detalles Financieros -->
                    <div attrs="{'invisible': [('step', '!=', 'step4')]}">
                        <div class="oe_title">
                            <h1>Paso 4: Detalles Financieros</h1>
                            <p>Configure los valores y términos de pago del contrato</p>
                        </div>
                        
                        <group>
                            <group string="Valores Principales">
                                <field name="currency_id"/>
                                <field name="contract_value" attrs="{'required': [('step', '=', 'step4')]}"/>
                                <field name="monthly_fee"/>
                                <field name="setup_fee"/>
                                <field name="deposit"/>
                            </group>
                            <group string="Términos de Pago">
                                <field name="billing_cycle"/>
                                <field name="payment_method"/>
                            </group>
                        </group>
                        
                        <group string="Líneas de Detalle (Opcional)">
                            <field name="line_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="name"/>
                                    <field name="quantity"/>
                                    <field name="unit_price"/>
                                    <field name="subtotal"/>
                                </tree>
                            </field>
                        </group>
                        
                        <group string="Información Adicional">
                            <field name="special_conditions" nolabel="1"/>
                        </group>
                        
                        <group string="Notas Internas">
                            <field name="internal_notes" nolabel="1"/>
                        </group>
                    </div>

                    <!-- Paso 5: Revisión y Confirmación -->
                    <div attrs="{'invisible': [('step', '!=', 'step5')]}">
                        <div class="oe_title">
                            <h1>Paso 5: Revisión y Confirmación</h1>
                            <p>Revise todos los datos antes de crear el contrato</p>
                        </div>
                        
                        <div class="alert alert-info">
                            <strong>¡Casi terminamos!</strong> Por favor revise toda la información antes de crear el contrato.
                        </div>
                        
                        <group string="Información del Cliente">
                            <field name="partner_name" readonly="1" attrs="{'invisible': [('create_new_partner', '=', False)]}"/>
                            <field name="partner_id" readonly="1" attrs="{'invisible': [('create_new_partner', '=', True)]}"/>
                            <field name="partner_email" readonly="1" attrs="{'invisible': [('create_new_partner', '=', False)]}"/>
                        </group>
                        
                        <group string="Configuración del Contrato">
                            <field name="contract_type_id" readonly="1"/>
                            <field name="template_id" readonly="1"/>
                            <field name="date_start" readonly="1"/>
                            <field name="duration_months" readonly="1"/>
                            <field name="auto_renewal" readonly="1"/>
                        </group>
                        
                        <group string="Representante Legal">
                            <field name="legal_representative_name" readonly="1"/>
                            <field name="legal_representative_position" readonly="1"/>
                            <field name="legal_representative_id_number" readonly="1"/>
                            <field name="legal_representative_email" readonly="1"/>
                        </group>
                        
                        <group string="Información Financiera">
                            <field name="contract_value" readonly="1"/>
                            <field name="monthly_fee" readonly="1"/>
                            <field name="setup_fee" readonly="1"/>
                            <field name="billing_cycle" readonly="1"/>
                            <field name="payment_method" readonly="1"/>
                        </group>
                        
                        <group string="Responsable">
                            <field name="contract_manager_id" readonly="1"/>
                        </group>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Acción para abrir el wizard -->
    <record id="action_contract_wizard" model="ir.actions.act_window">
        <field name="name">Crear Contrato</field>
        <field name="res_model">contract.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- CSS personalizado para el wizard -->
    <template id="contract_wizard_assets" name="Contract Wizard Assets">
        <xpath expr="." position="inside">
            <style>
                .progress-indicator {
                    display: flex;
                    justify-content: center;
                    margin: 20px 0;
                    padding: 15px;
                    background-color: #f8f9fa;
                    border-radius: 8px;
                }
                
                .step-indicator {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    margin: 0 20px;
                    position: relative;
                }
                
                .step-number {
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    background-color: #e9ecef;
                    color: #6c757d;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 14px;
                    margin-bottom: 5px;
                }
                
                .step-number.active {
                    background-color: #007bff;
                    color: white;
                }
                
                .step-label {
                    font-size: 12px;
                    color: #6c757d;
                    text-align: center;
                }
                
                .step-indicator:not(:last-child)::after {
                    content: '';
                    position: absolute;
                    top: 15px;
                    left: 50px;
                    width: 40px;
                    height: 2px;
                    background-color: #e9ecef;
                    z-index: -1;
                }
            </style>
        </xpath>
    </template>

    <!-- Menú para crear contrato -->
    <menuitem id="menu_contract_wizard"
              name="Crear Contrato"
              parent="menu_contract_main"
              action="action_contract_wizard"
              sequence="5"/>
</odoo>
